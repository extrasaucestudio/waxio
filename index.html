<html>
    <head> 
        <title>Waxio - WAX Dashboard</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="files/codebase/suite.js"></script>
		<link rel="stylesheet" href="files/codebase/suite.css">
		<link rel="stylesheet" href="files/index.css">
        <script src='files/menu.js'></script>
        <script src='waxjs.js'></script>
        
    <script>
var url_string = window.location.href;
var url = new URL(url_string);
var ref = url.searchParams.get("ref") || 'waxquestwax1';
var wax_wallet = url.searchParams.get("waxwallet") || 'waxquestwax1';
console.log('Wallet: ' + wax_wallet);
//console.log(username);
//sessionStorage.setItem('ref');
//sessionStorage.setItem('wax_wallet');
//var wallet = ${wax.userAccount};
console.log(sessionStorage.getItem('waxwallet'));
const waxwallet = sessionStorage.getItem('waxwallet');

console.log(sessionStorage.getItem('affiliatewallet'));
const affiliatewallet = sessionStorage.getItem('affiliatewallet');

//const affiliate_wallet = url.searchParams.get("ref") || 'waxquestwax1';
//const charactername = url.searchParams.get("ref") || 'waxquestwax1';

//console.log(charactername):

</script>
     </head> 
        <!--<body style="background-image: url('files/bg3-plain.png');" align="center">-->
        <body>
        <center>
        <div hidden="hidden" class="clickable" onclick="dhxwindow.show()">show</div>
        <div class="container">
        <iframe name="iframe" class="reponsive-iframe" src="go.html" width="100%" height="100%"></iframe>
        </div>
        <script>
			const windowHtml = '<img id="login" onclick=login() style="display: block; width: 50px; height: 50px; margin-top: 20px; margin-left: auto; margin-right: auto" src="files/wax.svg"><center><input hidden="hidden" id="wallet"><p id="response"></p></center><p><strong>Xpension</strong> - <a target="iframe" href="https://play.xpsgame.io/">Play</a><br></p><p><strong>FreeCityGame</strong> - <a target="iframe" href="https://play.remixworlds.com/">Play</a> - <a target="iframe" href="https://play.remixworlds.com/ranking/">Ranking</a> - <a target="iframe" href="https://play.remixworlds.com/faq/">Docs</a><br></p><p><strong>WaxQuest</strong> - <a target="iframe" href="https://waxquest.com">Play</a><br></p><p><strong>WaxRush</strong> - <a target="iframe" href="https://waxrush.com">Play</a> - <a target="iframe" href="https://waxrush.com/referral?ref=">Embed this tool$</a><br></p><p><strong>WaxAffiliation</strong> - <a target="iframe" href="https://waxaffiliation.io/affiliation.html?ref=">Home</a> - <a target="iframe" href="https://waxaffiliation.io/affiliate.html?ref=">Affiliate listing</a><br></p><details><summary>More Games</summary><p><strong>WaxAffiliation</strong> - <a target="iframe" href="https://waxaffiliation.io/affiliation.html?ref=">Home</a> - <a target="iframe" href="https://waxaffiliation.io/affiliate.html?ref=">Affiliate listing</a><br></p></details>';
			
            const dhxwindow = new dhx.Window({
				width: 300,
				height: 750,
				closable: false,
				movable: true,
				modal: false,
				title: 'Waxio Dashboard (Drag me)',
				html: windowHtml
			});

			dhxwindow.show();
		</script>
        <script>
            const wax = new waxjs.WaxJS({
              rpcEndpoint: 'https://wax.greymass.com'
            });
            // const wax = new waxjs.WaxJS({
            //   rpcEndpoint: 'http://wax-all.test:8888',
            //   tryAutoLogin: true,
            //   waxSigningURL: 'http://all-access.wax.test:8113',
            //   waxAutoSigningURL: 'http://idm.wax.test:8113/v1/accounts/auto-accept/'
            // });
          
            async function login() {
              try {
                const userAccount = await wax.login();
                document.getElementById('wallet').value = userAccount;
                document.getElementById('response').append('Wallet: ' + wax.userAccount);
                await getCurrentMessage();
              } catch(e) {
                document.getElementById('response').append(e.message);
              }
            }
          
            async function sign() {
              if(!wax.api) {
                return document.getElementById('response').append('* Login first *');
              }
          
              const wallet = document.getElementById('wallet').value;
          
              try {
                const result = await wax.api.transact({
                  actions: [{
                    account: 'freecitygamx',
                    name: 'adduseraff',
                    authorization: [{
                      actor: wax.userAccount,
                      permission: 'active',
                    }],
                    data: {
                      wallet,
                      affiliate_wallet: ref,
                    },
                  }]
                }, {
                  blocksBehind: 3,
                  expireSeconds: 30
                });
                document.getElementById('response').append('* You are Register *');
                await new Promise(resolve => setTimeout(resolve, 1000));
                await getCurrentMessage();
              } catch(e) {
                document.getElementById('response').append('* Expired Transaction *');
              }
            }
          
            async function getCurrentMessage() {
              const res = await wax.rpc.get_table_rows({
                json: true,
                code: 'freecitygamx',
                scope: 'freecitygamx',
                table: 'users',
                lower_bound: wax.userAccount,
                upper_bound: wax.userAccount,
              });
          
              const message = res.rows[0] ? res.rows[0].message : `<No message is set for ${wax.userAccount}>`;
            }
          
            // set a random value to the initial message value
            document.getElementById('message').value = Math.random().toString(36).substring(2);
          
          </script>
</center>


   
<!--
     <script>
    const windowHtml = '<strong><a href="https://play.remixworlds.com/" target="iframe">2222</a> - <a href="https://remixdapp.vercel.app" target="iframe">Test</a></strong><iframe name="iframe" src="https://remixworlds.com/" width="100%" height="100%"></iframe>';
    
    const dhxwindow = new dhx.Window({
        width: 600,
        height: 725,
        closable: false,
        movable: true,
        modal: false,
        resize: true,
        title: 'Wax Dashboard - Wallet: ' + wax_wallet,
        html: windowHtml
    });

    dhxwindow.show2();
</script>
-->




        <!--
        <div id="debug"></div>
        <script>
            fetch("../config.json")
            .then(response => response.json())
            .then(data => {
                console.log(data.website_url)
                document.querySelector("#debug").innerText = data.website_url
            })

            </script>
        -->


    </body>
</html>