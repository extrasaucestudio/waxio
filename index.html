<html>
    <head> 
        <title>Waxio - WAX Dashboard</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="files/codebase/suite.js"></script>
		<link rel="stylesheet" href="files/codebase/suite.css">
		<link rel="stylesheet" href="files/index.css">
        <script src='files/menu.js'></script>
        <script src='waxjs.js'></script>
        
    <script>
var url_string = window.location.href;
var url = new URL(url_string);
var ref = url.searchParams.get("ref") || 'waxquestwax1';
var wax_wallet = url.searchParams.get("waxwallet") || 'waxquestwax1';
console.log('Wallet: ' + wax_wallet);
//console.log(username);
//sessionStorage.setItem('ref');
//sessionStorage.setItem('wax_wallet');
//var wallet = ${wax.userAccount};
console.log(sessionStorage.getItem('waxwallet'));
const waxwallet = sessionStorage.getItem('waxwallet');

console.log(sessionStorage.getItem('affiliatewallet'));
const affiliatewallet = sessionStorage.getItem('affiliatewallet');

//const affiliate_wallet = url.searchParams.get("ref") || 'waxquestwax1';
//const charactername = url.searchParams.get("ref") || 'waxquestwax1';

//console.log(charactername):

</script>
     </head> 
        <!--<body style="background-image: url('files/bg3-plain.png');" align="center">-->
        <body>
        <center>
        <div hidden="hidden" class="clickable" onclick="dhxwindow.show()">show</div>
        <div class="container">
        <iframe name="iframe" class="reponsive-iframe" src="go.html" width="100%" height="100%"></iframe>
        </div>
        <script>
			const windowHtml = '<p><strong>Xpension</strong> - <a target="iframe" href="https://play.xpsgame.io/">Play</a><br><strong>FreeCityGame</strong> - <a target="iframe" href="https://play.remixworlds.com/">Play</a> - <a target="iframe" href="https://play.remixworlds.com/ranking/">Ranking</a> - <a target="iframe" href="https://play.remixworlds.com/faq/">Docs</a><br><strong>WaxQuest</strong> - <a target="iframe" href="https://waxquest.com">Play</a><br><strong>WaxRush</strong> - <a target="iframe" href="https://waxrush.com">Play</a> - <a target="iframe" href="https://waxrush.com/referral?ref=">Embed this tool$</a><br><strong>WaxAffiliation</strong> - <a target="iframe" href="https://waxaffiliation.io/affiliation.html?ref=">Home</a> - <a target="iframe" href="https://waxaffiliation.io/affiliate.html?ref=">Affiliate listing</a><br></p><details><summary>More Games</summary><p><strong>WaxAffiliation</strong> - <a target="iframe" href="https://waxaffiliation.io/affiliation.html?ref=">Home</a> - <a target="iframe" href="https://waxaffiliation.io/affiliate.html?ref=">Affiliate listing</a></p></details><br><hr><table><tr><th><img id="login" onclick=login() style="display: block; width: 50px; height: 50px; margin-top: 20px; margin-left: auto; margin-right: auto" src="files/wax.svg">&nbsp;</th><th id="current2">WaxLogin</th></tr></table><div class="clickable" id="current3"></div><strong><div class="clickable" id="sign" onclick=sign() alt="Subscribe & Play">Subscribe & Play</div></strong></div><p id="response"></p><p hidden="hidden" id="current"></p><input hidden="hidden" id="wallet">';
			
            const dhxwindow = new dhx.Window({
				width: 300,
				height: 750,
				closable: false,
				movable: true,
				modal: false,
				title: 'Waxio Dashboard (Drag me)',
				html: windowHtml
			});

			dhxwindow.show();
		</script>



    <script>
        const wax = new waxjs.WaxJS({
          rpcEndpoint: 'https://wax.greymass.com'
        });
      
        async function login() {
          try {
            const userAccount = await wax.login();
            document.getElementById('wallet').value = wax.userAccount;
            
         

            await getCurrentMessage();
          } catch(e) {
            document.getElementById('response').append(e.message);
          }
        }
      
        async function sign() {
          if(!wax.api) {
            return document.getElementById('response').append('* Login first *');
            
          }
      
          const wallet = document.getElementById('wallet').value;

      
          try {
            const result = await wax.api.transact({
              actions: [{
                account: 'freecitygamx',
                name: 'adduseraff',
                authorization: [{
                  actor: wax.userAccount,
                  permission: 'active',
                }],
                data: {
                  wallet,
                  affiliate_wallet,
                },
              }]
            }, {
              blocksBehind: 3,
              expireSeconds: 30
            });
            
            document.getElementById('response').append(`Thank You ${wax.userAccount}`);
            window.location.replace("/play.php");
            // document.getElementById('response').append(wax.userAccount);

            // document.createElement("<div id='myID'> my Text </div>");
            // document.body.insertBefore(elem,document.body.childNodes[0]);

            // document.getElementById('response').append(JSON.stringify(result));
            // console.log(result); 
            await new Promise(resolve => setTimeout(resolve, 1000));
            await getCurrentMessage();
          } catch(e) {
            document.getElementById('response').append('* Expired Transaction *');
          }
        }
      
          async function getCurrentMessage() {
          const res = await wax.rpc.get_table_rows({
            json: true,
            code: 'freecitygamx',
            scope: 'freecitygamx',
            table: 'users',
            lower_bound: wax.userAccount,
            upper_bound: wax.userAccount,
          });
      
          const message = res.rows[0] ? res.rows[0].message : `Wallet: ${wax.userAccount}`;
          document.getElementById('current').textContent = message;
          document.getElementById('current2').textContent = `${wax.userAccount}`;
          document.getElementById('current3').textContent = `Now you are ready to `;
          sessionStorage.setItem('waxwallet', wax.userAccount);
          console.log(sessionStorage.getItem('waxwallet'));
          sessionStorage.setItem('affiliatewallet', ref);
          console.log(sessionStorage.getItem('affiliatewallet'));
          
          
                           
          //console.log(sessionStorage.getItem('waxwallet'));
          
          //document.getElementById('current3').textContent = `${wax.userAccount}`;
      
          //document.getElementById('nameinput').append(wax.userAccount);

          //document.getElementById('nameinput').textContent = wax.userAccount;

          // document.getElementById('current2').append(wax.userAccount);
          //document.getElementById('options').textContent = (wax.userAccount);
          //document.getElementById('options').textContent = (new GrowlNotification(options)).show();
        }
         // set a random value to the initial message value
        document.getElementById('message').value = Math.random().toString(36).substring(2);
      
      </script>
</center>


   
<!--
     <script>
    const windowHtml = '<strong><a href="https://play.remixworlds.com/" target="iframe">2222</a> - <a href="https://remixdapp.vercel.app" target="iframe">Test</a></strong><iframe name="iframe" src="https://remixworlds.com/" width="100%" height="100%"></iframe>';
    
    const dhxwindow = new dhx.Window({
        width: 600,
        height: 725,
        closable: false,
        movable: true,
        modal: false,
        resize: true,
        title: 'Wax Dashboard - Wallet: ' + wax_wallet,
        html: windowHtml
    });

    dhxwindow.show2();
</script>
-->




        <!--
        <div id="debug"></div>
        <script>
            fetch("../config.json")
            .then(response => response.json())
            .then(data => {
                console.log(data.website_url)
                document.querySelector("#debug").innerText = data.website_url
            })

            </script>
        -->


    </body>
</html>